<div class="my-appointments-container">
  <div class="header">
    <h2>
      <mat-icon>event_available</mat-icon>
      My Appointments
    </h2>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
  </div>

  <!-- No Appointments -->
  <div *ngIf="!loading && appointments.length === 0" class="no-appointments">
    <mat-icon>event_busy</mat-icon>
    <p>You don't have any appointments yet.</p>
    <a mat-raised-button color="primary" routerLink="/patient-portal/booking">
      <mat-icon>add</mat-icon>
      Book an Appointment
    </a>
  </div>

  <!-- Appointments Table -->
  <div *ngIf="!loading && appointments.length > 0" class="appointments-table">
    <table mat-table [dataSource]="appointments" class="mat-elevation-z2">

      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let appointment">
          {{ formatDate(appointment) }}
        </td>
      </ng-container>

      <!-- Time Column -->
      <ng-container matColumnDef="time">
        <th mat-header-cell *matHeaderCellDef>Time</th>
        <td mat-cell *matCellDef="let appointment">
          {{ formatTime(appointment) }}
        </td>
      </ng-container>

      <!-- Procedure Column -->
      <ng-container matColumnDef="procedure">
        <th mat-header-cell *matHeaderCellDef>Procedure</th>
        <td mat-cell *matCellDef="let appointment">
          {{ getProcedureName(appointment) }}
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let appointment">
          <span class="status-badge" [ngClass]="getStatusClass(appointment)">
            {{ getStatusLabel(appointment) }}
          </span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let appointment">
          <!-- Edit (Reschedule) - only for future scheduled appointments -->
          <button mat-icon-button color="primary"
                  *ngIf="canEdit(appointment)"
                  matTooltip="Reschedule Appointment"
                  (click)="editAppointment(appointment)">
            <mat-icon>edit</mat-icon>
          </button>

          <!-- Delete (Cancel) - only for future scheduled appointments -->
          <button mat-icon-button color="warn"
                  *ngIf="canDelete(appointment)"
                  matTooltip="Cancel Appointment"
                  (click)="deleteAppointment(appointment)">
            <mat-icon>delete</mat-icon>
          </button>

          <!-- No actions available -->
          <span *ngIf="!canEdit(appointment) && !canDelete(appointment)" class="no-action">-</span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div class="book-more">
      <a mat-raised-button color="primary" routerLink="/patient-portal/booking">
        <mat-icon>add</mat-icon>
        Book New Appointment
      </a>
    </div>
  </div>
</div>
